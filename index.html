<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Profit Calculator Simple</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="min-h-screen bg-slate-900 text-slate-100 p-6">
  <div class="max-w-3xl mx-auto bg-white/5 rounded-xl p-6 shadow-xl backdrop-blur">
    <h1 class="text-2xl font-bold mb-4">Profit Calculator (ซื้อ-ขายหลายตัว)</h1>

    <table class="w-full text-sm text-left mb-4" id="calcTable">
      <thead>
        <tr>
          <th class="p-2 border-b">#</th>
          <th class="p-2 border-b">ต้นทุน/ชิ้น</th>
          <th class="p-2 border-b">ราคาขาย/ชิ้น</th>
          <th class="p-2 border-b">จำนวน</th>
          <th class="p-2 border-b">กำไร/ชิ้น</th>
          <th class="p-2 border-b">กำไรรวม</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td class="p-2">1</td>
          <td class="p-2"><input type="number" class="w-full p-1 rounded bg-white/10 border border-white/20 cost" value="0"></td>
          <td class="p-2"><input type="number" class="w-full p-1 rounded bg-white/10 border border-white/20 price" value="0"></td>
          <td class="p-2"><input type="number" class="w-full p-1 rounded bg-white/10 border border-white/20 qty" value="1"></td>
          <td class="p-2 profitPer">0</td>
          <td class="p-2 totalProfit">0</td>
        </tr>
      </tbody>
    </table>

    <button id="addRow" class="bg-green-600 px-3 py-1 rounded hover:bg-green-700">+ เพิ่มแถว</button>

    <div class="mt-4 bg-white/10 p-3 rounded">
      <div class="flex justify-between"><span>ต้นทุนรวม:</span><span id="totalCost">0</span></div>
      <div class="flex justify-between"><span>ยอดขายรวม:</span><span id="totalRevenue">0</span></div>
      <div class="flex justify-between"><span>กำไรรวม:</span><span id="grandProfit">0</span></div>
      <div class="flex justify-between"><span>ROI:</span><span id="roi">0%</span></div>
    </div>
  </div>

<script>
function updateRow(row){
  const cost = Number(row.querySelector(".cost").value);
  const price = Number(row.querySelector(".price").value);
  const qty = Number(row.querySelector(".qty").value);

  const profitPer = price - cost;
  const totalProfit = profitPer * qty;

  row.querySelector(".profitPer").textContent = profitPer.toLocaleString();
  row.querySelector(".totalProfit").textContent = totalProfit.toLocaleString();
}

function updateSummary(){
  const rows = document.querySelectorAll("#calcTable tbody tr");
  let totalCost = 0, totalRevenue = 0, grandProfit = 0;

  rows.forEach(row=>{
    const cost = Number(row.querySelector(".cost").value);
    const price = Number(row.querySelector(".price").value);
    const qty = Number(row.querySelector(".qty").value);

    totalCost += cost * qty;
    totalRevenue += price * qty;
    grandProfit += (price - cost) * qty;
  });

  document.getElementById("totalCost").textContent = totalCost.toLocaleString();
  document.getElementById("totalRevenue").textContent = totalRevenue.toLocaleString();
  document.getElementById("grandProfit").textContent = grandProfit.toLocaleString();
  document.getElementById("roi").textContent = totalCost>0 ? ((grandProfit/totalCost)*100).toFixed(2) + "%" : "0%";
}

function attachEvents(row){
  ["cost","price","qty"].forEach(cls=>{
    row.querySelector("."+cls).addEventListener("input",()=>{
      updateRow(row);
      updateSummary();
    });
  });
}

document.querySelectorAll("#calcTable tbody tr").forEach(attachEvents);

document.getElementById("addRow").addEventListener("click", ()=>{
  const tbody = document.querySelector("#calcTable tbody");
  const index = tbody.children.length + 1;
  const tr = document.createElement("tr");
  tr.innerHTML = `
    <td class="p-2">${index}</td>
    <td class="p-2"><input type="number" class="w-full p-1 rounded bg-white/10 border border-white/20 cost" value="0"></td>
    <td class="p-2"><input type="number" class="w-full p-1 rounded bg-white/10 border border-white/20 price" value="0"></td>
    <td class="p-2"><input type="number" class="w-full p-1 rounded bg-white/10 border border-white/20 qty" value="1"></td>
    <td class="p-2 profitPer">0</td>
    <td class="p-2 totalProfit">0</td>
  `;
  tbody.appendChild(tr);
  attachEvents(tr);
});
</script>
</body>
</html>
