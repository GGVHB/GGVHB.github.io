<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Investment Tracker</title>
<script src="https://cdn.tailwindcss.com"></script>
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.24.0/firebase-app.js";
  import { getFirestore, collection, addDoc, doc, getDocs, updateDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/9.24.0/firebase-firestore.js";
  import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.24.0/firebase-auth.js";

  // üîπ ‡πÉ‡∏™‡πà Firebase config ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_PROJECT.firebaseapp.com",
    projectId: "YOUR_PROJECT_ID",
    storageBucket: "YOUR_PROJECT.appspot.com",
    messagingSenderId: "SENDER_ID",
    appId: "APP_ID"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const auth = getAuth(app);

  const adminEmail = "admin@example.com"; // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô email admin ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì

  // Login / Logout
  window.login = async ()=>{
    const email = document.getElementById("loginEmail").value;
    const password = document.getElementById("loginPass").value;
    try { await signInWithEmailAndPassword(auth,email,password); alert("‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!"); loadData(); }
    catch(e){ alert("‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: "+e.message); }
  }
  window.logout = ()=>{ signOut(auth); alert("‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡πâ‡∏ß"); }

  // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà + ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
  async function loadData(){
    const categoriesDiv = document.getElementById("categoriesContainer");
    categoriesDiv.innerHTML="";
    const cats = await getDocs(collection(db,"categories"));
    for(const cat of cats.docs){
      const catId = cat.id;
      const catData = cat.data();
      const catDiv = document.createElement("div");
      catDiv.className="bg-gray-800/50 rounded-xl p-3 mb-4";
      catDiv.innerHTML = `<h2 class="font-bold text-lg mb-2">${catData.name}</h2>
      <div id="items-${catId}" class="space-y-2"></div>`;
      categoriesDiv.appendChild(catDiv);

      const itemsDiv = document.getElementById(`items-${catId}`);
      const itemsSnap = await getDocs(collection(db,"categories",catId,"items"));
      itemsDiv.innerHTML="";
      itemsSnap.forEach(item=>{
        const itemData = item.data();
        const profitPer = itemData.price - (itemData.cost/itemData.qty);
        const totalProfit = profitPer * itemData.qty;
        const row = document.createElement("div");
        row.className="bg-gray-700/50 rounded-xl p-2 grid grid-cols-6 gap-2 items-center";
        row.innerHTML = `
          <div>${itemData.name}</div>
          <div>${itemData.cost}</div>
          <div>${itemData.price}</div>
          <div>${itemData.qty}</div>
          <div>${profitPer.toFixed(2)}</div>
          <div>${totalProfit.toFixed(2)}</div>
        `;
        // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô admin ‡πÉ‡∏´‡πâ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç/‡∏•‡∏ö
        onAuthStateChanged(auth,user=>{
          if(user && user.email === adminEmail){
            row.innerHTML += `
              <button class="bg-yellow-500 px-2 rounded" onclick="editItem('${catId}','${item.id}')">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
              <button class="bg-red-600 px-2 rounded" onclick="deleteItem('${catId}','${item.id}')">‡∏•‡∏ö</button>
            `;
          }
        });
        itemsDiv.appendChild(row);
      });

      // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô admin ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
      onAuthStateChanged(auth,user=>{
        if(user && user.email === adminEmail){
          const addBtn = document.createElement("button");
          addBtn.className="bg-green-600 px-3 py-1 rounded mt-2 hover:bg-green-700";
          addBtn.textContent = "+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£";
          addBtn.onclick = ()=>addItem(catId);
          catDiv.appendChild(addBtn);
        }
      });
    }
  }

  // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà / ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ / ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç / ‡∏•‡∏ö
  window.addCategory = async ()=>{
    const name = prompt("‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà?");
    if(!name) return;
    await addDoc(collection(db,"categories"),{ name });
    loadData();
  }

  window.addItem = async (catId)=>{
    const name = prompt("‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£?");
    if(!name) return;
    const cost = parseFloat(prompt("‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏£‡∏ß‡∏°?","500"))||0;
    const price = parseFloat(prompt("‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πà‡∏≠‡∏ä‡∏¥‡πâ‡∏ô?","10"))||0;
    const qty = parseInt(prompt("‡∏à‡∏≥‡∏ô‡∏ß‡∏ô?","10"))||1;
    await addDoc(collection(db,"categories",catId,"items"),{ name,cost,price,qty });
    loadData();
  }

  window.editItem = async (catId,itemId)=>{
    const docRef = doc(db,"categories",catId,"items",itemId);
    const cost = parseFloat(prompt("‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏£‡∏ß‡∏°?","0"))||0;
    const price = parseFloat(prompt("‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πà‡∏≠‡∏ä‡∏¥‡πâ‡∏ô?","0"))||0;
    const qty = parseInt(prompt("‡∏à‡∏≥‡∏ô‡∏ß‡∏ô?","1"))||1;
    await updateDoc(docRef,{cost,price,qty});
    loadData();
  }

  window.deleteItem = async (catId,itemId)=>{
    if(confirm("‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£?")) { await deleteDoc(doc(db,"categories",catId,"items",itemId)); loadData(); }
  }

  window.onload = ()=>{ loadData(); }
</script>
</head>
<body class="bg-gradient-to-br from-gray-900 to-gray-800 text-white p-4">

<div class="max-w-xl mx-auto">
  <h1 class="text-2xl font-bold mb-4 text-center">Investment Tracker</h1>

  <div id="loginDiv" class="mb-4">
    <input id="loginEmail" type="email" placeholder="Email" class="p-2 rounded text-black w-full mb-2">
    <input id="loginPass" type="password" placeholder="Password" class="p-2 rounded text-black w-full mb-2">
    <button onclick="login()" class="bg-blue-600 px-4 py-2 rounded w-full mb-2 hover:bg-blue-700">Login Admin</button>
  </div>

  <button onclick="logout()" class="bg-gray-600 px-4 py-2 rounded w-full mb-4 hover:bg-gray-700">Logout</button>
  <button onclick="addCategory()" class="bg-blue-500 px-3 py-1 rounded mb-4 w-full hover:bg-blue-600">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</button>

  <div id="categoriesContainer" class="space-y-4"></div>
</div>

</body>
</html>
